<VirtualHost *:80>
    ServerName 127.0.0.1
    DocumentRoot /var/www/html

    # Jangan tampilkan directory listing di root
    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Kecualikan uploads/products dari proxy - biarkan Apache/PHP menanganinya
    <Directory /var/www/html/uploads/products>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        # Jangan disable PHP execution di sini (untuk lab)
    </Directory>

    # Pastikan apache tidak akan men-list directory uploads jika Indexes dimatikan pada root,
    # tapi kita izinkan index untuk uploads/products agar tester bisa lihat listing bila perlu.
    # Jika kamu ingin NON-listing juga untuk uploads, ubah Options di atas.

    # Reverse proxy: forward semua request root ke Flask service (di network docker compose)
    ProxyPreserveHost On
    ProxyRequests Off

    # Kecualikan path uploads/products dari proxy (biarkan Apache melayani)
    ProxyPass /uploads/products !
    ProxyPass / http://app:5000/
    ProxyPassReverse / http://app:5000/

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
